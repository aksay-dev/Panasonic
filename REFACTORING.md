Вот краткий список улучшений, дающих максимум пользы при умеренных правках:

- Табличное ядро без switch
  - Ввести единый descriptor-таблица для TOP/XT/OPT: {topic, byteIndex, decoderFn, scale, flags}, и цикл по ней.
  - Убрать остатки switch/if; все маппинги в таблице.

- Helpers с индексом
  - Добавить обёртки вида getIntMinus128_idx(i), getPower_idx(i), getBit7and8_idx(i).
  - Постепенно заменить прямые обращения: код станет короче и ровнее.

- Единая обработка дробей
  - Вынести “доли по байту 118” в helper apply_fraction(temp, fracBits, shift), чтобы не дублировать.

- Типы и безопасность
  - Использовать enum для режимов/состояний (operating_mode_state и пр.).
  - Для битовых полей сделать компактные bitfield-структуры/inline декодеры.
  - Делать полную запись в временную структуру и атомарное обновление g_decoded_data по завершении.

- Константные данные в flash
  - Все таблицы имен/описаний и topicBytes/xtopicBytes/optBytes объявить как const, чтобы хранить во flash.
  - По возможности объединить описательные строки в один массив и ссылки по индексам.

- Логи и конфигурация
  - Обернуть подробный вывод в #if CONFIG_DECODER_VERBOSE_LOG или уровни ESP_LOGX.
  - В decoder_log_all печатать только изменившиеся поля (optional), чтобы уменьшить шум.

- MQTT публикации
  - Таблица сопоставлений поле → topic → publishFn → qos/retain, цикл публикации; убрать ручные вызовы.
  - Отдельная таблица для “интов ×100” и “чистых интов” (масштаб в карте).

- Тесты/верификация
  - Юнит-тесты helpers и выборки по фиксированным входам (golden vectors) + сравнение с HeishaMon логами.
  - Фаззинг входного буфера на границы/битовые комбинации.

- Производительность/размер
  - static inline для маленьких helpers.
  - Объединить группы однотипных полей в компактные циклы (температуры/кривые/дельты).
  - Включить LTO/-Os, убедиться, что строки остаются в flash.

- Протокол/надёжность
  - Валидация пакета: тип/длина/CRC перед декодом; единый статус ошибки.
  - Версионирование схемы (если формат изменится — легко адаптировать таблицу).

- API чистота
  - Держать две обёртки: decoder_decode_*() (использует глобалы) и decoder_decode_from(const uint8_t* buf) для юнит-тестов/симуляций.

Скажите, какие из пунктов внедрить первыми — предложу минимальные правки и сразу применю.